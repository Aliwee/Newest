<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>setting-password</title>
	<link rel="stylesheet" media="screen" href="css/index.css">
	<link rel="stylesheet" type="text/css" href="font/font.css">
	<link rel="stylesheet" type="text/css" href="css/setup.css">
	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="js/GlobalValue.js"></script>
	<style>
		.review{
			float: left;
			font-size: 13px;
			height: 30px;
			line-height: 30px;
		}
		#right-container .review{
			height: 20px;
			font-size: 14px;
			line-height: 20px;
			margin-left: 10px;
		}
	</style>
	<!--
    	作者：731275785@qq.com
    	时间：2017-07-22
    	描述：验证登录与加载用户数据
    -->
	<script>
		if($.cookie('newestUserId')==null || $.cookie('newestUserName')==null){
			window.location.href = "login-register.html";
		}
	</script>
</head>
<body>
	<div id="index-container">
		<div id="index-head">
			<div id="index-head-inner">
				<a href="index.html"><img style="height: 50px; float: left;" src="pic/title.png"></a>
				<ul id="index-head-nav">
					<li><a href="index.html">新鲜事</a>
						<ul>
							<li><a href="publish-post.html">发布</a></li>
							<li><a href="mypost.html">我的</a></li>
						</ul>
					</li>
					<li><a>新闻</a>
						<ul>
							<li><a id="new-tech">要闻</a></li>
							<li><a id="new-science">科学</a></li>
							<li><a id="new-soft">软件</a></li>
							<li><a id="new-game">游戏</a></li>
							<li><a id="new-movie">影视</a></li>
							<li><a id="new-comic">动漫</a></li>
							<li><a id="new-funny">趣闻</a></li>
						</ul>
					</li>
				</ul>
				<div class="search-bar">
					<div id="popver">
						<div id="search-bar-container">
							<input id="search-bar-input" type="text" placeholder="搜索你感兴趣的内容">
							<button id="search-bar-button"></button>
						</div>
					</div>
				</div>
				<button class="search-button" id="search">搜索</button>
			</div>
		</div>
		<div style="padding: 0 16px;margin: 65px auto auto auto">
			<div id="new-content">
				<div id="setup">
					<a href="setup.html"><div class="setup-tab">我的信息</div></a>
					<a href="change-head.html"><div class="setup-tab">我的头像</div></a>
					<div style="cursor: text;" class="setup-tab">修改密码</div>
				</div>
				<div id="new-container">
					<div id="setup-content-main">
						<div class="setup-container">
							<p class="sbi-l">邮箱:</p>
							<div class="sbi-m" style="height: 20px;line-height: 20px;">
								<span style="color: #636363;" id="myEmail"></span>
							</div>
						</div>
						<div class="setup-container">
							<p class="sbi-l">验证码:</p>
							<div class="sbi-m">
								<span><input style="width: 130px;" class="user-name" type="text" id="inputVe"></span>
							</div>
							<div class="sbi-m">
								<input type="submit" id="verify" class="search-button" value="获取验证码" onclick="settime(this)">
							</div>
							<div class="sbi-m" style="height: 20px;line-height: 20px;">
								<span style="color: #636363;font-size: 12px;color: #ED6452" id="nodify4"></span>
							</div>
						</div>
						<div class="setup-container">
						<p class="sbi-l" style="height: 20px;"></p>
							<a>
								<button class="search-button" style="margin: 0" id="nextStep">下一步</button>
							</a>
						</div>
					</div>
				</div>
			</div>
			<div id="index-right">
				<div id="right-container">
					<div class="person-head" id="myHeadPic"></div>
					<div class="person-name" id="myName"></div>
					<div class="person-piece">
						<img height="20px" style="float: left;" src="pic/review.png">
						<div class="review" id="myReview">@我的</div>
					</div>
					<div class="person-piece">
						<img height="20px" style="float: left;" src="pic/like.png">
						<div class="review" id="myLike">我的喜欢</div>
					</div>
					<div class="person-piece">
						<img height="20px" style="float: left;" src="pic/setup.png">
						<div class="review" id="mySetting">我的设置</div>
					</div>
					<button id="log-out">注 销</button>
				</div>
			</div>
		</div>
	</div>
</body>
	<!--
		描述：验证码点击60s倒计时
	-->
	<script>
		var countdown=60; 
	  	function settime(obj) {
	  		if (countdown == 0) {
	  			obj.removeAttribute("disabled");
	  			obj.value = "获取验证码";
	  			countdown = 60;
	  			return;
	  		} else {
	  			obj.setAttribute("disabled", true);
	  			obj.value = "重新发送(" + countdown + ")";
	  			countdown--;
	  		}
	  		setTimeout(function() {
	  			settime(obj)
	  		}, 1000)
	  	}
	</script>

	<!--
    	作者：731275785@qq.com
    	时间：2017-07-22
    	描述：验证登录与加载用户数据
    -->
	<script>
		if($.cookie('newestUserId') &&  $.cookie('newestUserName')){
			$("#myName").html($.cookie('newestUserName'));
			$("#myHeadPic").css("background-image","url("+$.cookie('newestUserPic')+")");
			$("#myHeadPic").css("background-size","100px 100px");
			$("#myEmail").html($.cookie('newestUserId'));
			$("#inputVe").val("");
		}
	</script>
	
	<!--
    	作者：731275785@qq.com
    	时间：2017-07-22
    	描述：注销
    -->
    <script>
    	function logOut(){
//  		$.cookie('newestUserId', null, {
//          	expires : -1,
//	        });
	        $.cookie('newestUserPassword', null, {
	            expires : -1,
	        });
	        $.cookie('newestUserName',null, {
	            expires : -1,
	        });
	        $.cookie('newestUserPic',null, {
	            expires : -1,
	        });
    	}
    	$("#log-out").click(function(){
    		logOut();
    		window.location.reload();
    	})
    </script>
    
    <!--
    	作者：731275785@qq.com
    	时间：2017-07-24
    	描述：选择新闻种类
    -->
    <script>
    	$("#new-funny").click(function(){
    		window.location.href = "subnew.html?category=funny";
    	});
    	$("#new-game").click(function(){
    		window.location.href = "subnew.html?category=game";
    	});
    	$("#new-movie").click(function(){
    		window.location.href = "subnew.html?category=movie";
    	});
    	$("#new-comic").click(function(){
    		window.location.href = "subnew.html?category=comic";
    	});
    	$("#new-soft").click(function(){
    		window.location.href = "subnew.html?category=soft";
    	});
    	$("#new-tech").click(function(){
    		window.location.href = "subnew.html?category=tech";
    	});
    	$("#new-science").click(function(){
    		window.location.href = "subnew.html?category=science";
    	})
    </script>
    
    <!--
    	作者：731275785@qq.com
    	时间：2017-07-25
    	描述：@我的
    -->
    <script>
    	$("#myReview").click(function(){
    		window.location.href = "review-list.html";
    	});
    </script>
    
    <!--
    	作者：731275785@qq.com
    	时间：2017-07-25
    	描述：我的设置
    -->
    <script>
    	$("#mySetting").click(function(){
    		window.location.href = "setup.html";
    	});
    	$("#myLike").click(function(){
    		window.location.href = "mylike.html";
    	});
    </script>
    
    <!--
    	作者：731275785@qq.com
    	时间：2017-07-25
    	描述：全局变量
    -->
    <script>
    	var u1 = u + "change-password";
    	var u2 = u + "verify";
    	var ajaxobj;
    </script>
    
    <!--
    	作者：731275785@qq.com
    	时间：2017-07-25
    	描述：发送验证码
    -->
    <script>
    	$("#verify").click(function(){
    		$("#nodify4").html("");
    		$.ajax({
    			type:"post",
    			url:u2,
    			async:true,
    			contentType: "application/x-www-form-urlencoded; charset=utf-8",
    			data:{
    				user_id: $.cookie('newestUserId')		
    			},
    			success: function(data){
    				ajaxobj = JSON.parse(data);
    				if(ajaxobj.isOk == true){
    					$("#nodify4").html("验证码已发送至您的邮箱");
    					$("#inputVe").data("verify",ajaxobj.msg);
    				}
    			}
    		});
    	});
    </script>
    
    <!--
    	作者：731275785@qq.com
    	时间：2017-07-25
    	描述：验证码的验证
    -->
    <script>
    	function checkVerify(){
			var validVe = $("#inputVe").data("verify");
			var inputVe = $("#inputVe").val();
			
			
			if(validVe != inputVe) {
				$("#inputVe").css("border","2px solid #ED6452");
			}
			else if(inputVe == ""){
				$("#inputVe").css("border","0");
			}
			else{
				$("#inputVe").css("border","2px solid #b7e86f");
			}
		}
		$("#inputVe").keyup(function(){
			checkVerify();
		});
    </script>
    
    <!--
    	作者：731275785@qq.com
    	时间：2017-07-25
    	描述：下一步
    -->
    <script>
    	$("#nextStep").click(function(){
    		var inputVal = $("#inputVe").val();
    		var validVe = $("#inputVe").data("verify");
    		
    		if(inputVal != validVe){
    			$("#nodify4").html("请先获取验证码");
    		}
    		else{
    			window.location.href = "change-password2.html";
    		}
    	});
    </script>
    
    <!--
    	作者：731275785@qq.com
    	时间：2017-07-26
    	描述：搜索
    -->
    <script>
    	$("#search").click(function(){
    		if($("#search-bar-input").val() != ""){
    			window.location.href = "search-user.html?keyword=" + $("#search-bar-input").val();
    		}
    	});
    </script>
</html>